@if (open) {
    <div class="modal">
        <div class="modal-content">
            <span class="close-btn" (click)="onCloseModal()">×</span>

            @if (loading) {
                <p>Cargando detalles del alumno...</p>
            } @else if (error) {
                <p class="error">{{ error }}</p>
            } @else if (alumno) {
                <div class="alumno-info">
                    <h2>Detalles del Alumno</h2>

                    <div class="info-container">
                        <div class="foto-container">
                            @if(alumno.foto) {
                                <img [src]="alumno.foto" [alt]="'Foto de ' + alumno.nombre" class="alumno-foto" (error)="handleImageError($event)" />
                            } @else {
                                <img src="assets/img/user-default.png" alt="Foto por defecto" class="alumno-foto" />
                            }
                        </div>
                        
                        <div class="datos-personales">
                            <p><span class="label">Num Control:</span> {{ alumno.num_control }}</p>
                            <p><span class="label">Nombre:</span> {{ alumno.nombre }} {{ alumno.ap_paterno }} {{ alumno.ap_materno }}</p>
                            <p><span class="label">Sexo:</span> {{ alumno.sexo }}</p>
                            <p><span class="label">Fecha Nac:</span> {{ alumno.fecha_nac }}</p>
                            <p><span class="label">Semestre:</span> {{ alumno.semestre }}</p>
                            <p><span class="label">Nivel:</span> {{ alumno.nivel }}</p>
                            <p><span class="label">Teléfono:</span> {{ alumno.telefono }}</p>
                            <p><span class="label">Correo:</span> {{ alumno.correo }}</p>
                            <p><span class="label">Carrera:</span> {{ alumno.carrera?.nombre }} ({{ alumno.carrera?.nombre_corto }})</p>
                        </div>
                    </div>

                    <div class="secciones-container">
                        @if (alumno.actividades?.length > 0) {
                            <div class="seccion">
                                <h3>Actividades</h3>
                                <div class="lista-container">
                                    @for (actividad of alumno.actividades; track actividad.id) {
                                        <div class="lista-item">
                                            <span class="item-nombre">{{ actividad.nombre }}</span>
                                            <span class="item-tipo">({{ actividad.tipo }})</span>
                                            <span class="item-horas">{{ actividad.horas }} horas</span>
                                            <span class="item-estado" [class.activo]="actividad.activo">
                                                {{ actividad.activo ? 'Activo' : 'Inactivo' }}
                                            </span>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                        
                        @if (alumno.eventos && alumno.eventos.length > 0) {
                            <div class="seccion">
                                <h3>Eventos</h3>
                                <div class="lista-container">
                                    @for (evento of alumno.eventos; track evento.id) {
                                        <div class="lista-item">
                                            <span class="item-nombre">{{ evento.nombre }}</span>
                                            <span class="item-fecha">{{ evento.fecha }}</span>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </div>
            } @else {
                <p>No se encontraron detalles del alumno.</p>
            }
            <div class="button-container">
            <div class="button-modal" (click)="toggleAddAlumnoToActividad()">Agregar a Actividad</div>
            </div>
            @if (openValues.openAddAlumnoToActividad) {
                <add-alumno-to-actividad *ngIf="openValues.openAddAlumnoToActividad" [id_alumno]="id_alumno!" (closeModal)="toggleAddAlumnoToActividad()"></add-alumno-to-actividad>
            }
            <div class="button-container">

            <div  class="button-modal"(click)="toggleAddAlumnoToEvento()">Agregar a Evento</div>
            </div>
            @if (openValues.openAddAlumnoToEvento) {
                <add-alumno-to-evento *ngIf="openValues.openAddAlumnoToEvento" [id_alumno]="id_alumno!" (closeModal)="toggleAddAlumnoToEvento()"></add-alumno-to-evento>
            }
        </div>
    </div>
}
